# Тепловая карта & Сила сигнала

\[VIDEO HERE]

Тепловая карта (ТК)- графическое представление прибыльности сигналов в зависимости от текущих . ТК показывают прибыльность (профит фактор) сигналов используя различные фильтрующие индикаторы. &#x20;

Сила сигнала - это прибыльность (PF) сигналов отфильтрованная по индикатору Trends. &#x20;

![Profit factor colours](https://lh3.googleusercontent.com/5DjiTp5hC\_ySuqIWF6qVOaNb1HIIKg11CIwG1rUrBWaQ5AE0zPrPRjuIeVuEv9ojr-jt7DjiXnC6AEPxd99z\_Lyx6FVTPBpq0QKmFW6kcHQHXgrU3rkGuNbn8F\_YZWSnLtsypd48)





### Как фильтруются сигналы?

> Фильтрующие индикаторы - Trends, PP, Summary, WPR, Momentum, Bulls, Bears &#x20;

Фильтрующие индикаторы - индикаторы которые используются для построения выборки сигналов для дальнейших расчетов профит фактора (прибыльности). \
\
Разберем как это работает на примере индикатора **Trends**: \
Все индикаторы делятся на 3 группы.\
Для индикатора Trends это будет 3 группы трендов \[ **Вниз** | **Вбок** | **Вверх** ]. \
Для расчетов прибыльности мы будем брать из истории сигналов только те сигналы, которые попали в определенную группу.  \
Тем самым создавая выборку соответствующую текущим условиям на рынке. Если на рынке тренд нисходящий тренд - для расчетов мы будем использовать только те сигналы которые появлялись на нисходящем тренде.  Таким образом мы формируем однородную выборку для индикатора трендов.&#x20;

Тот же принцип действует и для остальных индикаторов. Условно поделив индикаторы на 3 группы мы считаем прибыльность только для тех сигналов которые находятся в той же группе что и фильтрующий индикатор. Получая однородные выборки для каждого индикатора в отдельности.&#x20;





### Как рассчитывается профит фактор?

> **Профит фактор** -  показатель эффективности торговой стратегии, определяемый как отношение валовой прибыли к валовым убыткам. Сумма всех прибыльных сделок деленная на сумму всех убыточных. Торговая система прибыльна, если коэффициент прибыльности выше 1.0.

Для расчета профит фактора мы каждый алгоритм сигналов используем как торговую стратегию.  Торговая стратегия должна содержать:

* Правила открытия позиций - момент появления сигналов.
* Правила назначения стоп ордеров (Стоп-лосс(SL) и Тейк-профит(TP)).

#### Настройки SL/TP

Для назначения стоп ордеров мы используем 6 различных настроек. Настройки стоп ордеров для BUY сигналов.&#x20;

```
TP = Price + 5*ATR(14)  |  SL = Price - 2*ATR(14) 
TP = Price + 7*ATR(14)  |  SL = Price - 2*ATR(14) 
TP = Price + 6*ATR(14)  |  SL = Price - 3*ATR(14) 
TP = Price + 9*ATR(14)  |  SL = Price - 3*ATR(14) 
TP = Price + 8*ATR(14)  |  SL = Price - 4*ATR(14) 
TP = Price + 12*ATR(14) |  SL = Price - 4*ATR(14)
```

Для SELL сигналов нужно просто поменять + на - и наоборот.&#x20;

> ATR - Индикатор «Среднего истинного диапазона». По сути он равен среднему движению цены или средней свече за период 14 в свечей. Соответственно мы его используем для назначения стоп ордеров. При сильных движениях рынка стоп ордера будут длиннее. При малых движениях рынка стоп ордера будут короче.&#x20;

#### Расчет профит фактора

Спустя 25 свечей после появления сигнала, система проверяет прибыльность сигнала на истории котировок  исходя из настроек TP/SL. Мы получаем 6 значений прибыльности для каждого сигнала.&#x20;

При появлении сигнала мы считаем профит фактор (PF)  для каждой настройки TP/SL. Фильтруя сигналы по текущей волотильности (малая, средняя, высокая)- те мы берем для расчета только те сигналы которые соответствуют текущей волатильности рынка. Тем самым мы делаем выборку более однородной.  Полученные значения выводятся на торговой панели сигнала.&#x20;

![](<.gitbook/assets/image (13).png>)

Расчет: берем 15 свечей и считаем прибыльность сигнала, и берем только те сигналы которые находятся в восходящем тренде по данным индикатора, при этом отфильтровав их по определенным показателям.(у каждого индикатора свой показатель по которому отфильтровывается сигнал).

Суть тепловой карты -рассчитать какой был профит фактор при таких же значениях индикатора, что и текущее значение этого индикатора.&#x20;

Индикаторы которые относятся к ячейкам, распределены в таком же порядку что и описаны. IPP, iSummary, iWPR, iMomentum, iBulls, iBears-индикаторы относящиеся к каждой ячейке.&#x20;

Пример первая ячейка это IPP, и на дашборде смотрим IPP на дашборде IPP показывает что благоприятное время для покупки, но на тепловой карте IPP показывает при цвете красном, что в прошлом данный сигнал отработал плохо. Рассчитываем показатели сигнала на тепловой следующим образом( мы условно присваиваем значение данным индикатора: продажа-0, нейтральное состояние 1, покупка - цифра 2) Если индикатор показывает на покупку (как показано на дашборде), то мы берем все значение данных под цифрой 2 и рассчитываем только для этих данных профит фактор, если профит фактор положительный(выше >1) то значит в прошлом сигнал при тех же значениях и условиях отработал хорошо, и можно к нему прислушиваться(то первая ячейка на тепловой карте будет зеленого цвета).

![](https://lh4.googleusercontent.com/fTwx7KRTf8GstlXMI7CVS2pP-TdDnAsr5DlKgMBsIbR\_yc-EziFNAyikoAdxdaQIsUSOHwVZ3-TEA66KLC1NhqGzU\_tpYgKvICigrBXDpvtwc6zytbnqCKqCDNjaRGJOF-Ae09cT)

&#x20;Ссылка на таблицу с расчетами https://docs.google.com/spreadsheets/d/1lAo6xTY0gS4PggcAqZZp\_-RvQtyCOauH4f7ly3qaNHo/edit#gid=0
